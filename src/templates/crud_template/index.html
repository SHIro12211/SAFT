{% extends "body.html" %}
{% load i18n %}
{% block title %}{{ title }}{% endblock %}
{% block contents %}
    <div class="d-flex justify-content-between" id="bar_btn">{# barra supeior #}
        <div class="d-flex" style="position: relative ; right: 3px">
            <div><a href="{{ add_url }}">
                <button id="add_btn" class="btn btn-sm btn-success m-sm-1" title="{% trans 'Añadir' %}">
                    {# añadir #}
                    <svg color="white" xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                         fill="currentColor"
                         class="bi bi-folder-plus" viewBox="0 0 16 16">
                        <path d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                        <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 1 1 0 1H14v1.5a.5.5 0 1 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
                    </svg>
                </button>
            </a> {# btn add #}
            </div>
            <div>
                {% if w or af %}
                    <button id='btn_delete' class="btn btn-sm btn-danger m-sm-1" title="{% trans 'Eliminar' %}"
                            onclick="redirect_delete_masive(window.location.toString())">
                        <svg color="white" xmlns="http://www.w3.org/2000/svg" width="14" height="14"
                             fill="currentColor"
                             class="bi bi-folder-minus" viewBox="0 0 16 16">
                            <path d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                            <path d="M11 11.5a.5.5 0 0 1 .5-.5h4a.5.5 0 1 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                    </button>
                {% endif %}
            </div>
            {# btn delete #}
        </div>
        <div class="align-self-end">
            {% if filter %}
                {% include 'filter.html' %}
            {% endif %}
        </div>
    </div>
    {% if object_list %}
        <table class="table table-striped table-hover table-sm shadow  bg-body rounded " id="table_id"
               style="margin-bottom: 5px">
            <thead>
            <tr class="table-dark">
                <th>
                    <input id='check-toggle' class="form-check-input" type="checkbox">
                </th>
                {% for item in enc %}
                    <th class="text-center">
                        {% trans item %}
                    </th>
                {% endfor %}
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody id="table_workers_aft">
            {% include 'crud_template/index_body.html' %}
            </tbody>
        </table>
        {# ----------Paginacion--------- #}
        <div class="d-flex justify-content-between">
            {% if is_paginated %}
                {% include 'crud_template/paginator_index.html' %}
            {% endif %}
            <div class="text-end text-white badge bg-dark "
                 style="height: fit-content; margin-top: 4px; padding-bottom: 6px">{% trans 'Total' %}: {{ page_obj.paginator.count }}</div>

        </div>
        {# ---------------------------------- #}
    {% else %}
        <p>{% trans 'No existen datos' %}</p>
    {% endif %}
    <form id="form_hiden_delete_masive_af" action="{% url 'inventory:delete_fixed_asset_view' %}" method="get">
        <input id="input_hiden_list_id_af" name="list_id" type="hidden">
    </form>
    <form id="form_hiden_delete_masive_w" action="{% url 'people:delete_worker_view' %}" method="get">
        <input id="input_hiden_list_id_w" name="list_id" type="hidden">
    </form>
{% endblock %}
{% block scrip %}
    <script>
        //eliminar campo de department en el filtro si es un user JD
        window.addEventListener('load', () => {
            {% if perms.inventory.can_view_the_dpto_fixedasset %}
                form_filter = document.getElementById('id_id_department')
                form_filter.remove()
                for (let i = 0; i < document.getElementsByClassName('label_filter').length; i++) {
                    console.log(document.getElementsByClassName('label_filter')[i].innerHTML)
                    if (document.getElementsByClassName('label_filter')[i].innerHTML == 'Departamento') {
                        document.getElementsByClassName('label_filter')[i].remove()
                        break
                    }
                }
            {% endif %}
        })
        //-------------cambiar officinas-------------------------
        window.addEventListener('load', () => {
            select_office = document.getElementById('id_id_office')
            console.log(select_office.innerHTML)

            new_office_list = '<option value="" selected="">---------</option>\n'
            {% for office in office_list %}
                new_office_list += '<option value="{{ office.id }}">{{ office }}</option>\n'
            {% endfor %}
            select_office.innerHTML = new_office_list
            console.log(document.getElementById('id_id_office').innerHTML)

        })
        //--------cambiar_departamentos-------------
        window.addEventListener('load', () => {
            select_dpto = document.getElementById('id_id_department')
            new_dpto_list = '<option value="" selected="">---------</option>\n'
            {% for dpto in dpto_list %}
                new_dpto_list += '<option value="{{ dpto.id }}">{{ dpto }}</option>\n'
            {% endfor %}
            select_dpto.innerHTML = new_dpto_list
        })
        //----------------------llenar local storage---------------------------
        window.addEventListener('load', fill_localstorage('{{ user.person }}'))

        //--------------eliminar label del filter----------------
        window.addEventListener('load', () => {
            list_field = document.getElementsByClassName('field')
            for (let i = 0; i < list_field.length; i++) {
                list_field[i].children[0].children[0].remove()
            }
        })
        //----------------z-index filter--------------------
        window.addEventListener('load', () => {
            if (document.getElementById('filter'))
                document.getElementById('filter').addEventListener('click', () => {
                    btn_lang = document.getElementById('btn_lang')
                    btn_lang.setAttribute('style', 'position: fixed; top: 15px; right: 12px;z-index: 1044')
                })
        })

        document.getElementById('btn_lang').addEventListener('click', () => {
            btn_lang = document.getElementById('btn_lang')
            btn_lang.setAttribute('style', 'position: fixed; top: 15px; right: 12px;z-index: 2000')
        })
        //------------------cambiar id por nombres del local storage o la api--------------------------
        window.addEventListener("load", async () => {
            if (window.location.toString().includes('people')) {
                let rows_person = document.getElementById('table_workers_aft').children;
                //rows_person = a todas las row de tbody
                for (let i = 0; i < rows_person.length; i++) {
                    let id_person = rows_person[i].children[1].children[0]//td de la columna de id_person
                    if (window.location.toString().includes('/others/department/'))
                        id_person = rows_person[i].children[2]
                    if (window.location.toString().includes('/others/headdepartment/'))
                        id_person = rows_person[i].children[1]

                    if (id_person.innerText != '---') {
                        console.log(id_person.innerText)
                        prom = await search_ls_api(id_person.innerText)
                        if (prom) {
                            if ((!prom.area) || (!prom.active)) {
                                rows_person[i].setAttribute('bgcolor', '#ec505f')
                                rows_person[i].setAttribute('title', '{% trans 'Este trabajador no trabaja en Infocomunicaciones' %}')
                            }
                            id_person.innerText = prom.name;
                        }
                    }


                }
            } else
                console.log('No t encuentras en una onsubmiturl que incluya worker')
        });
        toggle_checkbox = document.getElementById('check-toggle')
        list_check = document.getElementsByClassName('col_check')
        toggle_checkbox.addEventListener('change', () => {
                for (let i = 0; i < list_check.length; i++) {
                    if (toggle_checkbox.checked)
                        list_check[i].checked = true
                    else
                        list_check[i].checked = false
                }
            }
        )
        document.getElementById('logout').addEventListener('click', () => {
            localStorage.clear()
        })
    </script>
{% endblock %}

